# Chess results

[Телеграм-бот](https://tele.gg/chessresults_bot) для получения уведомлений с сайта [chess-results.com](http://www.chess-results.com).

### Зависимости

Установить зависимости sqlite3: `apt install sqlite3 libsqlite3-dev`

### Установка

```
bundle
```

## Тесты

```
rspec
```

## Настройка и запуск

### Файл конфигурации

Пример файла конфигурации (`assets/config.yml`):

```yaml
---
# Токен телеграм-бота
:telegram_token: 333333333:AABUi9j8LjG79r8YeoFoFs89
# Путь к лог-файлу
:log: logs/bot.log
# Имя базы данных
:db: trackers.db
# User-Agent запросов к сайту
:ua:
  user-agent: 'Telegram bot for the notifying about results: @chessresults_bot'
```

### Структура БД

```sql
# Установленные трекеры
CREATE TABLE trackers (
# ID пользователя Telegram
uid INTEGER,
# ID турнира с сайта
tnr INTEGER,
# Номер участника турнира
snr INTEGER,
# Номер тура, уведомление о рассадке по которму уже направлено
draw INTEGER,
# Номер тура, уведомление о результатах которого уже направлено
result INTEGER
);
```

### chessresults_bot.rb

Запускается с одним из обязательных параметров:
`--listen` — режим получения сообщений от пользователей; запускать и поддерживать работу в фоновом режиме можно, например, [с помощью Monit](https://github.com/M1chael/qb/wiki/Monit)  
`--post` — режим отправки уведомлений; запускать по расписанию можно, например, [с помощью Cron](https://github.com/M1chael/qb/wiki/Cron)

## Использование

### Команды

#### /start
Запуск бота, вывод справочной информации

#### /list
Вывод списка установленных трекеров с возможностью удаления

#### <ID турнира>
Вывод списка участников с возможностью добавления в список отслеживания. Бот может работать только с активными турнирами с известной датой окончания.

Для получения ID нужно найти турнир на сайте и взять цифры из адресной строки после `/tnr`. Например, если в адресной строке написано: `http://chess-results.com/tnr506308.aspx?lan=11`, то ID турнира — `506308`.
